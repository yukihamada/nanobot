<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skill Marketplace - chatweb.ai</title>
  <meta name="description" content="AIã‚¹ã‚­ãƒ«ã‚’ç™ºè¦‹ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ã‚ãªãŸã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’å°‚é–€ã‚¹ã‚­ãƒ«ã§å¼·åŒ–ã—ã‚ˆã†ã€‚">
  <meta property="og:title" content="Skill Marketplace - chatweb.ai">
  <meta property="og:description" content="AIã‚¹ã‚­ãƒ«ã‚’ç™ºè¦‹ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«">
  <meta property="og:image" content="https://chatweb.ai/og.svg">
  <meta property="og:url" content="https://chatweb.ai/skill">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #141414;
      --border: #1e1e1e;
      --text: #e5e5e5;
      --muted: #777;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --green: #22c55e;
      --green-dim: rgba(34,197,94,0.15);
      --orange: #fb923c;
      --red: #ef4444;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    a { color: inherit; text-decoration: none; }

    /* Nav */
    nav {
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }
    .logo { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }
    .logo span { color: var(--accent); }
    .nav-links { display: flex; align-items: center; gap: 16px; }
    .nav-links a { color: var(--muted); font-size: 14px; font-weight: 500; }
    .nav-links a:hover { color: var(--text); }
    .nav-links a.active { color: var(--accent); }

    /* Page tabs */
    .page-tabs {
      display: flex; gap: 0;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      padding: 0 24px;
    }
    .page-tab {
      padding: 14px 20px; font-size: 14px; font-weight: 500;
      color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent;
      transition: all 0.2s; white-space: nowrap;
    }
    .page-tab:hover { color: var(--text); }
    .page-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    /* Main */
    .main { max-width: 1200px; margin: 0 auto; padding: 40px 24px 80px; }
    .page-section { display: none; }
    .page-section.active { display: block; }

    /* Hero */
    .hero { text-align: center; margin-bottom: 32px; }
    .hero h1 {
      font-size: 42px; font-weight: 800; letter-spacing: -1.5px; margin-bottom: 12px;
      background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .hero p { color: var(--muted); font-size: 16px; max-width: 640px; margin: 0 auto; }

    /* Search */
    .search-bar {
      max-width: 600px; margin: 0 auto 32px; position: relative;
    }
    .search-bar input {
      width: 100%; padding: 14px 48px 14px 20px;
      background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
      color: var(--text); font-size: 15px; outline: none; transition: all 0.2s;
    }
    .search-bar input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
    .search-bar::after { content: "\1F50D"; position: absolute; right: 18px; top: 50%; transform: translateY(-50%); font-size: 18px; opacity: 0.5; }

    /* Category Tabs */
    .tabs {
      display: flex; gap: 8px; margin-bottom: 32px;
      overflow-x: auto; -webkit-overflow-scrolling: touch;
      scrollbar-width: none; padding-bottom: 4px;
    }
    .tabs::-webkit-scrollbar { display: none; }
    .tab {
      padding: 8px 18px; border-radius: 20px;
      background: var(--surface); border: 1px solid var(--border);
      color: var(--muted); font-size: 14px; font-weight: 500;
      cursor: pointer; white-space: nowrap; transition: all 0.2s;
      user-select: none;
    }
    .tab:hover { border-color: var(--accent); color: var(--text); }
    .tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .tab .count {
      display: inline-block; margin-left: 6px; padding: 1px 7px;
      border-radius: 10px; font-size: 11px; font-weight: 600;
      background: rgba(255,255,255,0.15);
    }

    /* Stats */
    .stats { display: flex; justify-content: center; gap: 32px; margin-bottom: 32px; }
    .stat { text-align: center; }
    .stat-num { font-size: 28px; font-weight: 700; color: var(--accent); display: block; }
    .stat-label { font-size: 13px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }

    /* Grid */
    .skills-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px; margin-bottom: 48px;
    }

    /* Card */
    .skill-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
      padding: 24px; transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
      cursor: pointer; position: relative; overflow: hidden;
      display: flex; flex-direction: column;
    }
    .skill-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      border-color: var(--accent);
    }
    .skill-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--orange));
      opacity: 0; transition: opacity 0.3s;
    }
    .skill-card:hover::before { opacity: 1; }
    .skill-card.installed { border-color: rgba(34,197,94,0.3); }
    .skill-card.installed::before { background: var(--green); opacity: 1; }
    .skill-card.tool-type::before { background: linear-gradient(90deg, var(--orange), #f59e0b); opacity: 0.7; }
    .skill-card.tool-type:hover::before { opacity: 1; }

    .card-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; gap: 8px; }
    .card-top-left { display: flex; flex-direction: column; gap: 4px; }
    .skill-name { font-size: 17px; font-weight: 700; }
    .skill-type-badge {
      display: inline-block; padding: 2px 7px; border-radius: 4px;
      font-size: 10px; font-weight: 700; letter-spacing: 0.4px;
      text-transform: uppercase;
    }
    .skill-type-badge.prompt { background: rgba(99,102,241,0.15); color: var(--accent); }
    .skill-type-badge.tool { background: rgba(251,146,60,0.15); color: var(--orange); }
    .category-label {
      display: inline-block; padding: 3px 10px; border-radius: 6px;
      font-size: 11px; font-weight: 600; letter-spacing: 0.3px;
      background: rgba(99,102,241,0.15); color: var(--accent);
      white-space: nowrap; flex-shrink: 0;
    }
    .skill-description { color: var(--muted); font-size: 14px; line-height: 1.6; margin-bottom: 14px; flex: 1; }
    .card-footer { display: flex; align-items: center; justify-content: space-between; }
    .install-count { font-size: 12px; color: var(--muted); }
    .install-btn {
      padding: 6px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
      border: none; cursor: pointer; transition: all 0.2s;
    }
    .install-btn.install { background: var(--accent); color: #fff; }
    .install-btn.install:hover { background: var(--accent-hover); }
    .install-btn.installed { background: var(--green-dim); color: var(--green); }
    .install-btn.installed:hover { background: rgba(239,68,68,0.15); color: var(--red); }
    .install-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Loading / Empty */
    .loading { text-align: center; padding: 60px 20px; color: var(--muted); }
    .spinner {
      border: 3px solid var(--border); border-top-color: var(--accent);
      border-radius: 50%; width: 40px; height: 40px;
      animation: spin 0.8s linear infinite; margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .empty-state { text-align: center; padding: 80px 20px; color: var(--muted); display: none; }
    .empty-state h3 { font-size: 20px; color: var(--text); margin-bottom: 8px; }

    /* Modal */
    .modal {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
      z-index: 1000; padding: 20px; overflow-y: auto;
    }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .modal-content {
      background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
      padding: 32px; max-width: 700px; width: 100%; max-height: 90vh;
      overflow-y: auto; position: relative;
    }
    .modal-close {
      position: absolute; top: 20px; right: 20px; background: none; border: none;
      color: var(--muted); font-size: 28px; cursor: pointer;
      width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
      border-radius: 8px; transition: all 0.2s;
    }
    .modal-close:hover { background: var(--border); color: var(--text); }
    .modal-header { margin-bottom: 20px; }
    .modal-header h2 { font-size: 26px; margin-bottom: 8px; }
    .modal-header .modal-cat { display: inline-block; margin-bottom: 8px; }
    .modal-header p { color: var(--muted); font-size: 15px; line-height: 1.5; }
    .modal-actions { margin: 20px 0; }
    .modal-install-btn {
      padding: 12px 32px; border-radius: 12px; font-size: 15px; font-weight: 600;
      border: none; cursor: pointer; transition: all 0.2s; width: 100%;
    }
    .modal-install-btn.install { background: var(--accent); color: #fff; }
    .modal-install-btn.install:hover { background: var(--accent-hover); }
    .modal-install-btn.installed { background: var(--green-dim); color: var(--green); }
    .modal-install-btn.installed:hover { background: rgba(239,68,68,0.15); color: var(--red); }
    .modal-content pre {
      background: var(--bg); border: 1px solid var(--border); border-radius: 12px;
      padding: 20px; overflow-x: auto; font-size: 13px; line-height: 1.6; color: var(--text);
      margin: 16px 0; white-space: pre-wrap;
    }
    .modal-content code { font-family: 'Monaco','Menlo',monospace; }

    /* Publish form */
    .publish-form { max-width: 680px; margin: 0 auto; }
    .publish-form h2 { font-size: 28px; font-weight: 800; margin-bottom: 8px; }
    .publish-form .subtitle { color: var(--muted); font-size: 15px; margin-bottom: 32px; }
    .form-group { margin-bottom: 20px; }
    .form-group label {
      display: block; font-size: 13px; font-weight: 600; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;
    }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%; padding: 12px 16px;
      background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
      color: var(--text); font-size: 14px; outline: none; transition: all 0.2s;
      font-family: inherit;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      border-color: var(--accent); box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
    }
    .form-group textarea { resize: vertical; min-height: 120px; }
    .form-group .hint { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .form-group select option { background: var(--surface); }

    /* Skill type toggle */
    .type-toggle {
      display: flex; gap: 0; border-radius: 10px; overflow: hidden;
      border: 1px solid var(--border); width: fit-content;
    }
    .type-btn {
      padding: 10px 24px; font-size: 14px; font-weight: 600;
      background: transparent; border: none; cursor: pointer; color: var(--muted);
      transition: all 0.2s; flex: 1;
    }
    .type-btn.active { background: var(--accent); color: #fff; }
    .type-btn:first-child { border-radius: 9px 0 0 9px; }
    .type-btn:last-child { border-radius: 0 9px 9px 0; }

    .tool-fields, .prompt-fields { display: none; }
    .tool-fields.visible, .prompt-fields.visible { display: block; }

    .publish-btn {
      width: 100%; padding: 14px; border-radius: 12px; font-size: 15px; font-weight: 700;
      background: var(--accent); color: #fff; border: none; cursor: pointer;
      transition: all 0.2s; margin-top: 8px;
    }
    .publish-btn:hover { background: var(--accent-hover); }
    .publish-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* My Skills */
    .my-skills-header {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;
    }
    .my-skills-header h2 { font-size: 24px; font-weight: 700; }
    .my-skill-item {
      background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
      padding: 20px 24px; margin-bottom: 12px;
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }
    .my-skill-info { flex: 1; }
    .my-skill-name { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
    .my-skill-meta { font-size: 13px; color: var(--muted); display: flex; gap: 12px; flex-wrap: wrap; }
    .my-skill-actions { display: flex; gap: 8px; flex-shrink: 0; }
    .my-skill-btn {
      padding: 7px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
      border: 1px solid var(--border); background: transparent; color: var(--muted);
      cursor: pointer; transition: all 0.2s;
    }
    .my-skill-btn:hover { border-color: var(--accent); color: var(--text); }
    .my-skill-btn.danger:hover { border-color: var(--red); color: var(--red); }

    .empty-my-skills {
      text-align: center; padding: 60px 20px; color: var(--muted);
    }
    .empty-my-skills h3 { font-size: 18px; color: var(--text); margin-bottom: 8px; }
    .empty-my-skills a {
      display: inline-block; margin-top: 16px; padding: 10px 24px;
      background: var(--accent); color: #fff; border-radius: 10px; font-weight: 600; font-size: 14px;
    }

    /* Toast */
    .toast {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      background: var(--surface); border: 1px solid var(--border);
      padding: 12px 24px; border-radius: 12px; font-size: 14px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4); z-index: 2000;
      opacity: 0; transition: opacity 0.3s; pointer-events: none;
    }
    .toast.show { opacity: 1; }

    /* Auth notice */
    .auth-notice {
      text-align: center; padding: 12px; margin-bottom: 24px;
      background: rgba(99,102,241,0.1); border: 1px solid rgba(99,102,241,0.2);
      border-radius: 12px; font-size: 14px; color: var(--muted);
    }
    .auth-notice a { color: var(--accent); font-weight: 600; }

    @media (max-width: 768px) {
      .hero h1 { font-size: 30px; }
      .skills-grid { grid-template-columns: 1fr; }
      .stats { gap: 16px; }
      .modal-content { padding: 20px; }
      .my-skill-item { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <nav>
    <a href="/" class="logo">chat<span>web</span>.ai</a>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/pricing">Pricing</a>
      <a href="/docs">Docs</a>
      <a href="/skill" class="active">Skills</a>
    </div>
  </nav>

  <!-- Page-level tabs -->
  <div class="page-tabs">
    <div class="page-tab active" onclick="showPage('browse')">ã‚¹ã‚­ãƒ«ã‚’æ¢ã™</div>
    <div class="page-tab" id="publish-tab" onclick="showPage('publish')" style="display:none;">ã‚¹ã‚­ãƒ«ã‚’å…¬é–‹</div>
    <div class="page-tab" id="mine-tab" onclick="showPage('mine')" style="display:none;">ãƒã‚¤ã‚¹ã‚­ãƒ«</div>
  </div>

  <div class="main">

    <!-- ===== BROWSE PAGE ===== -->
    <div class="page-section active" id="page-browse">
      <div class="hero">
        <h1>Skill Marketplace</h1>
        <p>AIã‚¹ã‚­ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€ã‚ãªãŸã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€‚ä»•äº‹åŠ¹ç‡åŒ–ã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¾ã§ã€å°‚é–€ã‚¹ã‚­ãƒ«ãŒæƒã£ã¦ã„ã¾ã™ã€‚</p>
      </div>

      <div class="search-bar">
        <input type="text" id="search-input" placeholder="ã‚¹ã‚­ãƒ«ã‚’æ¤œç´¢..." autocomplete="off">
      </div>

      <div id="auth-notice" class="auth-notice" style="display:none;">
        ã‚¹ã‚­ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯<a href="/">ãƒ­ã‚°ã‚¤ãƒ³</a>ãŒå¿…è¦ã§ã™
      </div>

      <div class="tabs" id="tabs"></div>

      <div class="stats" id="stats">
        <div class="stat">
          <span class="stat-num" id="total-skills">-</span>
          <span class="stat-label">Total Skills</span>
        </div>
        <div class="stat">
          <span class="stat-num" id="installed-count">0</span>
          <span class="stat-label">Installed</span>
        </div>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading skills...</p>
      </div>

      <div class="skills-grid" id="skills-grid"></div>

      <div class="empty-state" id="empty-state">
        <h3>ã‚¹ã‚­ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h3>
        <p>åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</p>
      </div>
    </div>

    <!-- ===== PUBLISH PAGE ===== -->
    <div class="page-section" id="page-publish">
      <div class="publish-form">
        <h2>ã‚¹ã‚­ãƒ«ã‚’å…¬é–‹ã™ã‚‹</h2>
        <p class="subtitle">ã‚ãªãŸãŒä½œã£ãŸã‚¹ã‚­ãƒ«ã‚’ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å…¬é–‹ã—ã¾ã—ã‚‡ã†ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹ï¼ˆAIã¸ã®æŒ‡ç¤ºï¼‰ã¾ãŸã¯ãƒ„ãƒ¼ãƒ«å‹ï¼ˆWebhookã§å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼‰ã‚’é¸ã¹ã¾ã™ã€‚</p>

        <div class="form-group">
          <label>ã‚¹ã‚­ãƒ«ã‚¿ã‚¤ãƒ—</label>
          <div class="type-toggle">
            <button class="type-btn active" id="type-prompt-btn" onclick="setSkillType('prompt')">ğŸ’¬ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹</button>
            <button class="type-btn" id="type-tool-btn" onclick="setSkillType('tool')">ğŸ”§ ãƒ„ãƒ¼ãƒ«å‹</button>
          </div>
          <p class="hint">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹: AIã¸ã®è¿½åŠ æŒ‡ç¤ºã‚’Markdownã§è¨˜è¿°ã€‚ãƒ„ãƒ¼ãƒ«å‹: AIãŒã‚ãªãŸã®Webhook URLã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</p>
        </div>

        <div class="form-group">
          <label>ã‚¹ã‚­ãƒ«ID <span style="color:var(--red)">*</span></label>
          <input type="text" id="pub-id" placeholder="my-cooking-skill" pattern="[a-zA-Z0-9\-_]+" maxlength="64">
          <p class="hint">è‹±æ•°å­—ãƒ»ãƒã‚¤ãƒ•ãƒ³ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ã€‚URLãŠã‚ˆã³ãƒ„ãƒ¼ãƒ«åã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <div class="form-group">
          <label>ã‚¹ã‚­ãƒ«å <span style="color:var(--red)">*</span></label>
          <input type="text" id="pub-name" placeholder="æ–™ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ" maxlength="100">
        </div>

        <div class="form-group">
          <label>èª¬æ˜</label>
          <input type="text" id="pub-description" placeholder="æ–™ç†ãƒ¬ã‚·ãƒ”ã®ææ¡ˆã¨æ „é¤Šè¨ˆç®—ã‚’è¡Œã„ã¾ã™" maxlength="300">
        </div>

        <div class="form-group">
          <label>ã‚«ãƒ†ã‚´ãƒª</label>
          <select id="pub-category">
            <option value="general">General</option>
            <option value="productivity">Productivity</option>
            <option value="coding">Coding</option>
            <option value="writing">Writing</option>
            <option value="research">Research</option>
            <option value="creative">Creative</option>
            <option value="language">Language</option>
            <option value="business">Business</option>
            <option value="tools">Tools</option>
          </select>
        </div>

        <!-- Prompt-type fields -->
        <div class="prompt-fields visible" id="prompt-fields">
          <div class="form-group">
            <label>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ (Markdown) <span style="color:var(--red)">*</span></label>
            <textarea id="pub-content" placeholder="## æ–™ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ&#10;&#10;ã‚ãªãŸã¯æ–™ç†ã®å°‚é–€å®¶ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦ï¼š&#10;- ææ–™ã¨åˆ†é‡ã‚’è©³ã—ãèª¬æ˜ã™ã‚‹&#10;- æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒæ…®ã™ã‚‹&#10;- èª¿ç†ã®ã‚³ãƒ„ã‚’æ•™ãˆã‚‹" rows="8"></textarea>
            <p class="hint">AIã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹å†…å®¹ã§ã™ã€‚Markdownã§æ›¸ã„ã¦ãã ã•ã„ã€‚</p>
          </div>
        </div>

        <!-- Tool-type fields -->
        <div class="tool-fields" id="tool-fields">
          <div class="form-group">
            <label>Webhook URL <span style="color:var(--red)">*</span></label>
            <input type="url" id="pub-webhook-url" placeholder="https://your-api.example.com/skill-handler">
            <p class="hint">HTTPSå¿…é ˆã€‚AIãŒãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ãŸéš›ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚</p>
          </div>

          <div class="form-group">
            <label>ãƒ„ãƒ¼ãƒ«é–¢æ•°å</label>
            <input type="text" id="pub-skill-name" placeholder="ï¼ˆçœç•¥å¯: ã‚¹ã‚­ãƒ«IDã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰" maxlength="64">
            <p class="hint">AIãŒãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™éš›ã®é–¢æ•°åã€‚è‹±æ•°å­—ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ã€‚</p>
          </div>

          <div class="form-group">
            <label>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ (JSON Schema)</label>
            <textarea id="pub-schema" rows="8" style="font-family:monospace;font-size:13px;" placeholder='{
  "type": "object",
  "properties": {
    "query": {
      "type": "string",
      "description": "æ¤œç´¢ã‚¯ã‚¨ãƒª"
    }
  },
  "required": ["query"]
}'></textarea>
            <p class="hint">AIã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®JSON Schemaã€‚çœç•¥ã™ã‚‹ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—ã«ãªã‚Šã¾ã™ã€‚</p>
          </div>

          <div style="background:rgba(251,146,60,0.08);border:1px solid rgba(251,146,60,0.2);border-radius:10px;padding:14px 16px;margin-bottom:20px;font-size:13px;color:var(--muted);">
            <strong style="color:var(--orange);">Webhookãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜</strong><br>
            AIãŒãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ã¨ã€ã‚ãªãŸã®URLã«ä»¥ä¸‹ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ï¼š<br>
            â€¢ Content-Type: <code>application/json</code><br>
            â€¢ X-Skill-Name: ãƒ„ãƒ¼ãƒ«å<br>
            â€¢ Body: AIãŒæŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ<br>
            ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯AIã«è¿”ã•ã‚Œã¾ã™ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¾ãŸã¯JSONï¼‰ã€‚
          </div>
        </div>

        <button class="publish-btn" id="publish-btn" onclick="publishSkill()">å…¬é–‹ã™ã‚‹</button>
      </div>
    </div>

    <!-- ===== MY SKILLS PAGE ===== -->
    <div class="page-section" id="page-mine">
      <div class="my-skills-header">
        <h2>ãƒã‚¤ã‚¹ã‚­ãƒ«</h2>
        <button class="install-btn install" onclick="showPage('publish')" style="padding:8px 20px;">+ æ–°è¦å…¬é–‹</button>
      </div>
      <div class="loading" id="mine-loading" style="display:none;">
        <div class="spinner"></div>
        <p>èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
      <div id="mine-list"></div>
    </div>

  </div><!-- /main -->

  <!-- Skill Detail Modal -->
  <div class="modal" id="skill-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div class="modal-header">
        <span class="category-label modal-cat" id="modal-category"></span>
        <h2 id="modal-title"></h2>
        <p id="modal-description"></p>
      </div>
      <div class="modal-actions">
        <button class="modal-install-btn" id="modal-install-btn" onclick="toggleInstallFromModal()"></button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Edit Skill Modal -->
  <div class="modal" id="edit-modal">
    <div class="modal-content" style="max-width:620px;">
      <button class="modal-close" onclick="closeEditModal()">&times;</button>
      <h2 style="margin-bottom:20px;">ã‚¹ã‚­ãƒ«ã‚’ç·¨é›†</h2>
      <input type="hidden" id="edit-skill-id">
      <div class="form-group">
        <label>ã‚¹ã‚­ãƒ«å</label>
        <input type="text" id="edit-name" maxlength="100">
      </div>
      <div class="form-group">
        <label>èª¬æ˜</label>
        <input type="text" id="edit-description" maxlength="300">
      </div>
      <div class="form-group">
        <label>ã‚«ãƒ†ã‚´ãƒª</label>
        <select id="edit-category">
          <option value="general">General</option>
          <option value="productivity">Productivity</option>
          <option value="coding">Coding</option>
          <option value="writing">Writing</option>
          <option value="research">Research</option>
          <option value="creative">Creative</option>
          <option value="language">Language</option>
          <option value="business">Business</option>
          <option value="tools">Tools</option>
        </select>
      </div>
      <div class="form-group" id="edit-content-group">
        <label>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹</label>
        <textarea id="edit-content" rows="8"></textarea>
      </div>
      <div class="form-group" id="edit-webhook-group" style="display:none;">
        <label>Webhook URL</label>
        <input type="url" id="edit-webhook-url">
      </div>
      <div class="form-group" id="edit-schema-group" style="display:none;">
        <label>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ (JSON)</label>
        <textarea id="edit-schema" rows="6" style="font-family:monospace;font-size:13px;"></textarea>
      </div>
      <button class="publish-btn" id="edit-save-btn" onclick="saveEditedSkill()">ä¿å­˜ã™ã‚‹</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // State
    let allSkills = [];
    let installedIds = new Set();
    let activeCategory = null;
    let currentModalSkillId = null;
    let currentSkillType = 'prompt';
    const sessionKey = localStorage.getItem('session_key') || '';
    const isLoggedIn = !!sessionKey;

    // Auth headers
    function authHeaders() {
      return sessionKey ? { 'Authorization': `Bearer ${sessionKey}` } : {};
    }

    // Toast
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2500);
    }

    // Escape HTML
    function esc(text) {
      const d = document.createElement('div');
      d.textContent = text || '';
      return d.innerHTML;
    }

    // Page switching
    function showPage(page) {
      document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.page-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('page-' + page).classList.add('active');
      const tabs = { browse: 0, publish: 1, mine: 2 };
      document.querySelectorAll('.page-tab')[Object.keys(tabs).indexOf(page)].classList.add('active');
      if (page === 'mine') loadMySkills();
    }

    // Init
    async function init() {
      if (isLoggedIn) {
        document.getElementById('publish-tab').style.display = '';
        document.getElementById('mine-tab').style.display = '';
      } else {
        document.getElementById('auth-notice').style.display = 'block';
      }

      const [skillsData, installedData, categoriesData] = await Promise.all([
        fetch('/api/v1/skills').then(r => r.json()).catch(() => ({ skills: [] })),
        isLoggedIn
          ? fetch('/api/v1/skills/installed', { headers: authHeaders() }).then(r => r.json()).catch(() => ({ skills: [] }))
          : Promise.resolve({ skills: [] }),
        fetch('/api/v1/skills/categories').then(r => r.json()).catch(() => ({ categories: [] })),
      ]);

      allSkills = skillsData.skills || [];
      installedIds = new Set((installedData.skills || []).map(s => s.id));

      document.getElementById('total-skills').textContent = allSkills.length;
      document.getElementById('installed-count').textContent = installedIds.size;
      buildTabs(categoriesData.categories || []);
      document.getElementById('loading').style.display = 'none';
      displaySkills();
    }

    function buildTabs(categories) {
      const container = document.getElementById('tabs');
      const totalCount = allSkills.length;
      let html = `<div class="tab active" data-cat="" onclick="selectCategory(this, '')">ã™ã¹ã¦<span class="count">${totalCount}</span></div>`;
      for (const cat of categories) {
        html += `<div class="tab" data-cat="${esc(cat.name)}" onclick="selectCategory(this, '${esc(cat.name)}')">${esc(cat.name)}<span class="count">${cat.count}</span></div>`;
      }
      html += `<div class="tab" data-cat="__installed" onclick="selectCategory(this, '__installed')">ãƒã‚¤ã‚¹ã‚­ãƒ«<span class="count">${installedIds.size}</span></div>`;
      container.innerHTML = html;
    }

    function selectCategory(el, cat) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      activeCategory = cat || null;
      displaySkills();
    }

    function displaySkills() {
      const grid = document.getElementById('skills-grid');
      const empty = document.getElementById('empty-state');
      const query = document.getElementById('search-input').value.trim().toLowerCase();

      let filtered = allSkills;
      if (activeCategory === '__installed') {
        filtered = filtered.filter(s => installedIds.has(s.id));
      } else if (activeCategory) {
        filtered = filtered.filter(s => s.category === activeCategory);
      }
      if (query) {
        filtered = filtered.filter(s =>
          (s.name || '').toLowerCase().includes(query) ||
          (s.description || '').toLowerCase().includes(query) ||
          (s.id || '').toLowerCase().includes(query) ||
          (s.category || '').toLowerCase().includes(query)
        );
      }

      if (filtered.length === 0) {
        grid.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      grid.innerHTML = filtered.map(skill => {
        const isInstalled = installedIds.has(skill.id);
        const btnClass = isInstalled ? 'installed' : 'install';
        const btnText = isInstalled ? 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿' : 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«';
        const isToolType = skill.skill_type === 'tool';
        let cardClass = isInstalled ? 'skill-card installed' : 'skill-card';
        if (isToolType) cardClass += ' tool-type';
        const typeBadge = isToolType
          ? '<span class="skill-type-badge tool">ãƒ„ãƒ¼ãƒ«å‹</span>'
          : '<span class="skill-type-badge prompt">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹</span>';

        return `
          <div class="${cardClass}" onclick="openModal('${esc(skill.id)}')">
            <div class="card-top">
              <div class="card-top-left">
                <div class="skill-name">${esc(skill.name)}</div>
                ${typeBadge}
              </div>
              <span class="category-label">${esc(skill.category)}</span>
            </div>
            <div class="skill-description">${esc(skill.description)}</div>
            <div class="card-footer">
              <span class="install-count">${skill.installs || 0} installs</span>
              ${isLoggedIn ? `<button class="install-btn ${btnClass}" onclick="event.stopPropagation(); toggleInstall('${esc(skill.id)}', this)">${btnText}</button>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    // Install / Uninstall
    async function toggleInstall(skillId, btnEl) {
      if (!isLoggedIn) { showToast('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™'); return; }
      const isInstalled = installedIds.has(skillId);
      btnEl.disabled = true;
      try {
        const method = isInstalled ? 'DELETE' : 'POST';
        const resp = await fetch(`/api/v1/skills/${encodeURIComponent(skillId)}/install`, {
          method, headers: { ...authHeaders(), 'Content-Type': 'application/json' },
        });
        const data = await resp.json();
        if (resp.ok) {
          if (isInstalled) { installedIds.delete(skillId); showToast('ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸ'); }
          else { installedIds.add(skillId); showToast('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸï¼æ¬¡ã®ãƒãƒ£ãƒƒãƒˆã‹ã‚‰æœ‰åŠ¹ã«ãªã‚Šã¾ã™'); }
          document.getElementById('installed-count').textContent = installedIds.size;
          const myTab = document.querySelector('.tab[data-cat="__installed"] .count');
          if (myTab) myTab.textContent = installedIds.size;
          displaySkills();
          updateModalButton();
        } else {
          showToast(data.error || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      } catch (e) { showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
      btnEl.disabled = false;
    }

    // Modal
    async function openModal(skillId) {
      currentModalSkillId = skillId;
      const modal = document.getElementById('skill-modal');
      const title = document.getElementById('modal-title');
      const desc = document.getElementById('modal-description');
      const cat = document.getElementById('modal-category');
      const body = document.getElementById('modal-body');

      const local = allSkills.find(s => s.id === skillId);
      title.textContent = local ? local.name : skillId;
      desc.textContent = local ? local.description : 'Loading...';
      cat.textContent = local ? local.category : '';
      body.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
      updateModalButton();
      modal.classList.add('active');

      try {
        const resp = await fetch(`/api/v1/skills/${encodeURIComponent(skillId)}`);
        const data = await resp.json();
        title.textContent = data.name || skillId;
        desc.textContent = data.description || '';
        cat.textContent = data.category || '';

        const isToolType = data.skill_type === 'tool';
        if (isToolType) {
          body.innerHTML = `
            <div style="background:rgba(251,146,60,0.08);border:1px solid rgba(251,146,60,0.2);border-radius:10px;padding:14px 16px;margin-bottom:12px;font-size:13px;">
              <strong style="color:var(--orange);">ãƒ„ãƒ¼ãƒ«å‹ã‚¹ã‚­ãƒ«</strong><br>
              AIãŒã“ã®ã‚¹ã‚­ãƒ«ã‚’ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ã§ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨é€£æºã—ã¾ã™ã€‚
            </div>
            ${data.webhook_url ? `<p style="font-size:13px;color:var(--muted);margin-bottom:8px;">Webhook: <code style="font-family:monospace;">${esc(data.webhook_url.replace(/\/\/[^@]*@/, '//***@'))}</code></p>` : ''}
          `;
        } else {
          body.innerHTML = data.content
            ? `<h3 style="margin-bottom:12px;font-size:15px;color:var(--muted);">ã‚¹ã‚­ãƒ«å†…å®¹</h3><pre><code>${esc(data.content)}</code></pre>`
            : '<p style="color:var(--muted);">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }
      } catch (e) {
        body.innerHTML = '<p style="color:var(--muted);">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    function updateModalButton() {
      const btn = document.getElementById('modal-install-btn');
      if (!isLoggedIn || !currentModalSkillId) { btn.style.display = 'none'; return; }
      const isInstalled = installedIds.has(currentModalSkillId);
      btn.className = `modal-install-btn ${isInstalled ? 'installed' : 'install'}`;
      btn.textContent = isInstalled ? 'ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«' : 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«';
      btn.style.display = 'block';
    }

    async function toggleInstallFromModal() {
      if (!currentModalSkillId) return;
      const btn = document.getElementById('modal-install-btn');
      btn.disabled = true;
      const isInstalled = installedIds.has(currentModalSkillId);
      try {
        const method = isInstalled ? 'DELETE' : 'POST';
        const resp = await fetch(`/api/v1/skills/${encodeURIComponent(currentModalSkillId)}/install`, {
          method, headers: { ...authHeaders(), 'Content-Type': 'application/json' },
        });
        if (resp.ok) {
          if (isInstalled) { installedIds.delete(currentModalSkillId); showToast('ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸ'); }
          else { installedIds.add(currentModalSkillId); showToast('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸï¼æ¬¡ã®ãƒãƒ£ãƒƒãƒˆã‹ã‚‰æœ‰åŠ¹ã«ãªã‚Šã¾ã™'); }
          document.getElementById('installed-count').textContent = installedIds.size;
          const myTab = document.querySelector('.tab[data-cat="__installed"] .count');
          if (myTab) myTab.textContent = installedIds.size;
          displaySkills();
          updateModalButton();
        }
      } catch (e) { showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
      btn.disabled = false;
    }

    function closeModal() {
      document.getElementById('skill-modal').classList.remove('active');
      currentModalSkillId = null;
    }

    // Publish form
    function setSkillType(type) {
      currentSkillType = type;
      document.getElementById('type-prompt-btn').classList.toggle('active', type === 'prompt');
      document.getElementById('type-tool-btn').classList.toggle('active', type === 'tool');
      document.getElementById('prompt-fields').classList.toggle('visible', type === 'prompt');
      document.getElementById('tool-fields').classList.toggle('visible', type === 'tool');
    }

    async function publishSkill() {
      const btn = document.getElementById('publish-btn');
      const id = document.getElementById('pub-id').value.trim();
      const name = document.getElementById('pub-name').value.trim();
      const description = document.getElementById('pub-description').value.trim();
      const category = document.getElementById('pub-category').value;

      if (!id || !name) { showToast('IDã¨ã‚¹ã‚­ãƒ«åã¯å¿…é ˆã§ã™'); return; }
      if (!/^[a-zA-Z0-9\-_]+$/.test(id)) { showToast('IDã¯è‹±æ•°å­—ãƒ»ãƒã‚¤ãƒ•ãƒ³ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨ã§ãã¾ã™'); return; }

      const payload = { id, name, description, category, skill_type: currentSkillType };

      if (currentSkillType === 'prompt') {
        const content = document.getElementById('pub-content').value.trim();
        if (!content) { showToast('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
        payload.content = content;
      } else {
        const webhookUrl = document.getElementById('pub-webhook-url').value.trim();
        const skillName = document.getElementById('pub-skill-name').value.trim();
        const schemaStr = document.getElementById('pub-schema').value.trim();
        if (!webhookUrl) { showToast('Webhook URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
        if (!webhookUrl.startsWith('https://')) { showToast('Webhook URLã¯HTTPSå¿…é ˆã§ã™'); return; }
        payload.webhook_url = webhookUrl;
        if (skillName) payload.skill_name = skillName;
        if (schemaStr) {
          try { payload.parameters_schema = JSON.parse(schemaStr); }
          catch (e) { showToast('ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒã®JSONãŒä¸æ­£ã§ã™'); return; }
        }
      }

      btn.disabled = true;
      btn.textContent = 'å…¬é–‹ä¸­...';
      try {
        const resp = await fetch('/api/v1/skills/publish', {
          method: 'POST',
          headers: { ...authHeaders(), 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await resp.json();
        if (resp.ok) {
          showToast(`ã€Œ${name}ã€ã‚’å…¬é–‹ã—ã¾ã—ãŸï¼`);
          // Reset form
          document.getElementById('pub-id').value = '';
          document.getElementById('pub-name').value = '';
          document.getElementById('pub-description').value = '';
          document.getElementById('pub-content').value = '';
          document.getElementById('pub-webhook-url').value = '';
          document.getElementById('pub-skill-name').value = '';
          document.getElementById('pub-schema').value = '';
          showPage('mine');
        } else {
          showToast(data.error || 'å…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (e) { showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
      btn.disabled = false;
      btn.textContent = 'å…¬é–‹ã™ã‚‹';
    }

    // My Skills
    async function loadMySkills() {
      if (!isLoggedIn) {
        document.getElementById('mine-list').innerHTML = `
          <div class="empty-my-skills">
            <h3>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3>
            <p>ã‚¹ã‚­ãƒ«ã‚’å…¬é–‹ãƒ»ç®¡ç†ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
            <a href="/">ãƒ­ã‚°ã‚¤ãƒ³</a>
          </div>`;
        return;
      }
      const loading = document.getElementById('mine-loading');
      loading.style.display = 'block';
      document.getElementById('mine-list').innerHTML = '';

      try {
        const resp = await fetch('/api/v1/skills/mine', { headers: authHeaders() });
        const data = await resp.json();
        loading.style.display = 'none';
        const skills = data.skills || [];

        if (skills.length === 0) {
          document.getElementById('mine-list').innerHTML = `
            <div class="empty-my-skills">
              <h3>ã¾ã ã‚¹ã‚­ãƒ«ã‚’å…¬é–‹ã—ã¦ã„ã¾ã›ã‚“</h3>
              <p>ã‚ãªãŸãŒä½œã£ãŸã‚¹ã‚­ãƒ«ã‚’ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å…¬é–‹ã—ã¾ã—ã‚‡ã†</p>
              <a href="#" onclick="showPage('publish');return false;">ã‚¹ã‚­ãƒ«ã‚’å…¬é–‹ã™ã‚‹</a>
            </div>`;
          return;
        }

        document.getElementById('mine-list').innerHTML = skills.map(s => {
          const isToolType = s.skill_type === 'tool';
          const badge = isToolType
            ? '<span class="skill-type-badge tool">ãƒ„ãƒ¼ãƒ«å‹</span>'
            : '<span class="skill-type-badge prompt">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‹</span>';
          return `
            <div class="my-skill-item">
              <div class="my-skill-info">
                <div class="my-skill-name">${esc(s.name)} ${badge}</div>
                <div class="my-skill-meta">
                  <span>${esc(s.id)}</span>
                  <span>${esc(s.category)}</span>
                  <span>${s.installs || 0} installs</span>
                </div>
                ${s.description ? `<div style="font-size:13px;color:var(--muted);margin-top:4px;">${esc(s.description)}</div>` : ''}
              </div>
              <div class="my-skill-actions">
                <button class="my-skill-btn" onclick="openEditModal(${JSON.stringify(s)})">ç·¨é›†</button>
                <button class="my-skill-btn danger" onclick="deleteSkill('${esc(s.id)}', '${esc(s.name)}')">å‰Šé™¤</button>
              </div>
            </div>`;
        }).join('');
      } catch (e) {
        loading.style.display = 'none';
        document.getElementById('mine-list').innerHTML = '<p style="color:var(--muted);">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    async function deleteSkill(id, name) {
      if (!confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚`)) return;
      try {
        const resp = await fetch(`/api/v1/skills/${encodeURIComponent(id)}`, {
          method: 'DELETE',
          headers: authHeaders(),
        });
        if (resp.ok) {
          showToast(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
          loadMySkills();
        } else {
          const data = await resp.json();
          showToast(data.error || 'å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (e) { showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
    }

    function openEditModal(skill) {
      document.getElementById('edit-skill-id').value = skill.id;
      document.getElementById('edit-name').value = skill.name || '';
      document.getElementById('edit-description').value = skill.description || '';
      document.getElementById('edit-category').value = skill.category || 'general';

      const isToolType = skill.skill_type === 'tool';
      document.getElementById('edit-content-group').style.display = isToolType ? 'none' : '';
      document.getElementById('edit-webhook-group').style.display = isToolType ? '' : 'none';
      document.getElementById('edit-schema-group').style.display = isToolType ? '' : 'none';

      if (!isToolType) {
        // Fetch full content
        fetch(`/api/v1/skills/${encodeURIComponent(skill.id)}`).then(r => r.json()).then(d => {
          document.getElementById('edit-content').value = d.content || '';
        });
      } else {
        document.getElementById('edit-webhook-url').value = skill.webhook_url || '';
        // Fetch schema
        fetch(`/api/v1/skills/${encodeURIComponent(skill.id)}`).then(r => r.json()).then(d => {
          document.getElementById('edit-schema').value = d.parameters_schema
            ? JSON.stringify(d.parameters_schema, null, 2) : '';
        });
      }

      document.getElementById('edit-modal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('edit-modal').classList.remove('active');
    }

    async function saveEditedSkill() {
      const btn = document.getElementById('edit-save-btn');
      const id = document.getElementById('edit-skill-id').value;
      const name = document.getElementById('edit-name').value.trim();
      const description = document.getElementById('edit-description').value.trim();
      const category = document.getElementById('edit-category').value;
      const content = document.getElementById('edit-content').value.trim();
      const webhookUrl = document.getElementById('edit-webhook-url').value.trim();
      const schemaStr = document.getElementById('edit-schema').value.trim();

      const payload = { name, description, category };
      if (content) payload.content = content;
      if (webhookUrl) payload.webhook_url = webhookUrl;
      if (schemaStr) {
        try { payload.parameters_schema = JSON.parse(schemaStr); }
        catch (e) { showToast('ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒã®JSONãŒä¸æ­£ã§ã™'); return; }
      }

      btn.disabled = true;
      btn.textContent = 'ä¿å­˜ä¸­...';
      try {
        const resp = await fetch(`/api/v1/skills/${encodeURIComponent(id)}`, {
          method: 'PUT',
          headers: { ...authHeaders(), 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await resp.json();
        if (resp.ok) {
          showToast('ä¿å­˜ã—ã¾ã—ãŸ');
          closeEditModal();
          loadMySkills();
        } else {
          showToast(data.error || 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (e) { showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'); }
      btn.disabled = false;
      btn.textContent = 'ä¿å­˜ã™ã‚‹';
    }

    // Search
    let searchTimeout;
    document.getElementById('search-input').addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(displaySkills, 250);
    });

    // Modal close handlers
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') { closeModal(); closeEditModal(); }
    });
    document.getElementById('skill-modal').addEventListener('click', e => {
      if (e.target.id === 'skill-modal') closeModal();
    });
    document.getElementById('edit-modal').addEventListener('click', e => {
      if (e.target.id === 'edit-modal') closeEditModal();
    });

    // Init
    init();
  </script>
</body>
</html>
